# 1Passwordã®Vaultå
OP_VAULT="VAULT_EXAMPLE"

load_op_token() {
  echo "ğŸ” 1Password ã‹ã‚‰ service account token ã‚’å–å¾—ä¸­..."

  local token=$(
    if ! op whoami >/dev/null 2>&1; then
      eval $(op signin)
    fi

    op read "op://${OP_VAULT}/OP_SERVICE_ACCOUNT_TOKEN/credential" 2>/dev/null
  )

  if [ -z "$token" ]; then
    echo "âŒ Service account token ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ"
    return 1
  fi

  export OP_SERVICE_ACCOUNT_TOKEN="$token"

  if op whoami &>/dev/null; then
    echo "âœ… Service Account token ã‚’æ­£å¸¸ã«å–å¾—ã—ã¾ã—ãŸ"
  else
    echo "âŒ Service Account token ã®èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸ"
    unset OP_SERVICE_ACCOUNT_TOKEN
    return 1
  fi
}

load_op_token

export IMGPROXY_S3_REGION=$(op read "op://${OP_VAULT}/env_dev/Imgproxy/IMGPROXY_S3_REGION")
export IMGPROXY_AWS_ACCESS_KEY_ID=$(op read "op://${OP_VAULT}/env_dev/Imgproxy/IMGPROXY_AWS_ACCESS_KEY_ID")
export IMGPROXY_AWS_SECRET_ACCESS_KEY=$(op read "op://${OP_VAULT}/env_dev/Imgproxy/IMGPROXY_AWS_SECRET_ACCESS_KEY")
export IMGPROXY_S3_ENDPOINT=$(op read "op://${OP_VAULT}/env_dev/Imgproxy/IMGPROXY_S3_ENDPOINT")

docker compose up
